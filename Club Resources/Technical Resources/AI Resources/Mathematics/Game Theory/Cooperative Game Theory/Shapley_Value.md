# The Shapley Value

## Introduction
The **Shapley Value** is a central solution concept in cooperative game theory that provides a principled and uniquely "fair" method for distributing a collective gain or cost among a group of cooperating players. Developed by Nobel laureate Lloyd Shapley, the value of a player is based on their average expected contribution to the coalition. This elegant concept has wide-ranging applications in economics, political science, and, most recently, has become a cornerstone of **explainable artificial intelligence (XAI)**.

## The Core Idea: Average Marginal Contribution
The intuition behind the Shapley value is to determine a player's fair share based on the value they bring to the groups they join. It is calculated based on a player's **average marginal contribution**.

The thought experiment is as follows:
-   Imagine all the players lining up to form the "grand coalition" (the group of all players).
-   They arrive one by one in a random order.
-   When a player arrives, the value they add to the group that was already present is their **marginal contribution** for that specific arrival order.
-   The Shapley value for a player is the **average** of their marginal contributions, taken over every possible order in which they could have arrived.

## The Shapley Value Axioms and Formula

### The Axiomatic Foundation
The Shapley value is not just an arbitrary formula; it is the **only** allocation method that simultaneously satisfies four desirable fairness axioms:
1.  **Efficiency**: The sum of all players' individual payoffs must equal the total value generated by the grand coalition. (The entire "pie" is distributed).
2.  **Symmetry**: If two players are interchangeable (they contribute the exact same amount to every possible coalition they could join), they must receive the same payoff.
3.  **Dummy Player Property**: If a player adds no value to any coalition they join, their payoff is zero.
4.  **Additivity**: If a player participates in two separate games, their Shapley value in the combined game is the sum of their values from the individual games.

### The Formula
For a game with $n$ players and a characteristic function $v$ that gives the value of each coalition, the Shapley value for player $i$ is:

$$\phi_i(v) = \sum_{S \subseteq N \setminus \{i\}} \frac{|S|! (n - |S| - 1)!}{n!} [v(S \cup \{i\}) - v(S)]$$

Where:
-   The sum is over all coalitions $S$ that do not contain player $i$.
-   $[v(S \cup \{i\}) - v(S)]$ is the **marginal contribution** of player $i$ to the coalition $S$.
-   The fractional term is a weight that represents the probability that, in a random ordering of all players, the players in $S$ come before player $i$.

## Example: A 3-Player Project
**Scenario**: Three developers, Alice (A), Bob (B), and Carol (C), can work together on a software project. The profit they can generate in different coalitions is given by the characteristic function:
-   $v(\{\}) = 0$
-   $v(\{A\}) = 0, v(\{B\}) = 0, v(\{C\}) = 0$ (No one can complete the project alone)
-   $v(\{A,B\}) = 20k, v(\{A,C\}) = 20k, v(\{B,C\}) = 30k$
-   $v(\{A,B,C\}) = 40k$ (The grand coalition is most profitable)



### **Calculation using the permutation method**

There are three players (A, B, C), so there are $3! = 6$ possible orders in which they can join the project. The marginal contribution (MC) of a player is the value they add to the group when they join.

* **Order (A, B, C):**
    * $MC(A) = 0$
    * $MC(B) = v(\{A,B\}) - v(\{A\}) = 20$
    * $MC(C) = v(\{A,B,C\}) - v(\{A,B\}) = 20$
* **Order (A, C, B):**
    * $MC(A) = 0$
    * $MC(C) = v(\{A,C\}) - v(\{A\}) = 20$
    * $MC(B) = v(\{A,B,C\}) - v(\{A,C\}) = 20$
* **Order (B, A, C):**
    * $MC(B) = 0$
    * $MC(A) = v(\{A,B\}) - v(\{B\}) = 20$
    * $MC(C) = v(\{A,B,C\}) - v(\{A,B\}) = 20$
* **Order (B, C, A):**
    * $MC(B) = 0$
    * $MC(C) = v(\{B,C\}) - v(\{B\}) = 30$
    * $MC(A) = v(\{A,B,C\}) - v(\{B,C\}) = 10$
* **Order (C, A, B):**
    * $MC(C) = 0$
    * $MC(A) = v(\{A,C\}) - v(\{C\}) = 20$
    * $MC(B) = v(\{A,B,C\}) - v(\{A,C\}) = 20$
* **Order (C, B, A):**
    * $MC(C) = 0$
    * $MC(B) = v(\{B,C\}) - v(\{C\}) = 30$
    * $MC(A) = v(\{A,B,C\}) - v(\{B,C\}) = 10$

---

### **Calculate the Average Marginal Contribution (Shapley Value)**

The **Shapley value ($\phi$)** for each player is the average of their marginal contributions across all 6 permutations.

* **Alice ($\phi_{A}$):** Her marginal contributions are 0, 0, 20, 10, 20, and 10.
    * $\phi_{A} = \frac{0 + 0 + 20 + 10 + 20 + 10}{6} = \frac{60}{6} = 10$
    * **Alice's share is $10k.**

* **Bob ($\phi_{B}$):** His marginal contributions are 20, 20, 0, 0, 20, and 30.
    * $\phi_{B} = \frac{20 + 20 + 0 + 0 + 20 + 30}{6} = \frac{90}{6} = 15$
    * **Bob's share is $15k.**

* **Carol ($\phi_{C}$):** Her marginal contributions are 20, 20, 20, 30, 0, and 0.
    * $\phi_{C} = \frac{20 + 20 + 20 + 30 + 0 + 0}{6} = \frac{90}{6} = 15$
    * **Carol's share is $15k.**

The unique and fair distribution of the total profit, according to the Shapley value, is **Alice: $10k, Bob: $15k, and Carol: $15k**. Notice that the total of these shares ($10k + 15k + 15k = 40k$) equals the total profit of the grand coalition.

The unique "fair" distribution of the $40k total profit is Alice: $10k, Bob: $15k, and Carol: $15k. (Note: The sum is $10+15+15=40$, satisfying the efficiency axiom).

## Applications
1.  **Explainable AI (XAI)**: This is the most significant modern application. The **SHAP (SHapley Additive exPlanations)** framework uses the Shapley value to explain the predictions of complex machine learning models. In this context, the "players" are the model's input features, and the "game" is to produce a prediction. SHAP calculates the Shapley value for each feature, representing its contribution to pushing the model's prediction away from a baseline.

2.  **Cost Allocation**: For fairly dividing the cost of a shared resource. For example, if three companies share a warehouse, the Shapley value can determine each company's fair share of the total rent based on the space they use and the costs they would have incurred alone or in smaller groups.

3.  **Marketing Analytics**: To determine the contribution of each marketing channel (e.g., social media, email, paid search) to a final conversion. The Shapley value can fairly allocate credit to each channel in a customer's journey.

4.  **Voting Power Analysis**: In political science, to measure the true power of each party in a coalition government, which may not be directly proportional to their number of seats.